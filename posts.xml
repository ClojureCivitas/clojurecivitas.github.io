<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Clojure Civitas</title>
<link>https://clojurecivitas.github.io/posts.html</link>
<atom:link href="https://clojurecivitas.github.io/posts.xml" rel="self" type="application/rss+xml"/>
<description></description>
<image>
<url>https://clojurecivitas.github.io/images/civitas-icon.svg</url>
<title>Clojure Civitas</title>
<link>https://clojurecivitas.github.io/posts.html</link>
</image>
<generator>quarto-1.7.31</generator>
<lastBuildDate>Thu, 05 Jun 2025 00:00:00 GMT</lastBuildDate>
<item>
  <title>Clean object printing by removing extraneous</title>
  <dc:creator>Timothy Pratley</dc:creator>
  <link>https://clojurecivitas.github.io/clojure/print_object/remove_extraneous.html</link>
  <description><![CDATA[ 





<style></style>
<style>.printedClojure .sourceCode {
  background-color: transparent;
  border-style: none;
}
</style>
<style>.clay-limit-image-width .clay-image {max-width: 100%}
.clay-side-by-side .sourceCode {margin: 0}
.clay-side-by-side {margin: 1em 0}
</style>
<script src="clojure/print_object/remove_extraneous_files/md-default0.js" type="text/javascript"></script>
<script src="clojure/print_object/remove_extraneous_files/md-default1.js" type="text/javascript"></script>
<p>The Clojure default for printing objects is noisy. Clojure’s <code>print-method</code> for <code>Object</code> delegates to <code>clojure.core/print-object</code></p>
<div class="sourceClojure">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb1-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defmethod</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> print-method </span>Object [x ^java.io.Writer w]</span>
<span id="cb1-2">  (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">#'clojure.core/print-object</span> x w))</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb2-1">#object[clojure.lang.MultiFn <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">0xec824ca</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clojure.lang.MultiFn@ec824ca"</span>]</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb3-1">(Object.)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb4-1">#object[java.lang.Object <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">0x56ec31ca</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"java.lang.Object@56ec31ca"</span>]</span></code></pre></div>
</div>
<p>The syntax is <code>#object[CLASS-NAME HASH toString())]</code> and as you can see, the toString of an Object is <code>CLASS-NAME@HASH</code>. For most objects this becomes quite a long string.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb5-1">(async/chan)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb6-1">#object[clojure.core.async.impl.channels.ManyToManyChannel <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">0x1ece307c</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clojure.core.async.impl.channels.ManyToManyChannel@1ece307c"</span>]</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://clojurecivitas.github.io/clojure/print_object/objection.jpg" class="img-fluid figure-img"></p>
<figcaption>Objection!</figcaption>
</figure>
</div>
<p>Functions are printed as objects</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb7-1">(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [x] x)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb8-1">#object[clojure.print_object.remove_extraneous$eval22346$fn__22347 <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">0x17a3aa29</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clojure.print_object.remove_extraneous$eval22346$fn__22347@17a3aa29"</span>]</span></code></pre></div>
</div>
<p>It’s quite easy to miss the fact that it is a function as we are looking for a tiny little <code>fn</code> in a sea of text. If, like me, you are fond of the <a href="../../code_interview/beating/with_stupid_stuff/z_combinator_gambit.html">odd lambda calculus excursion</a>, things get even more hectic.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb9-1">((<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [x] (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [v] ((x x) v))) (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [y] y))</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb10-1">#object[clojure.print_object.remove_extraneous$eval22350$fn__22351$fn__22352 <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">0x11ad162d</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clojure.print_object.remove_extraneous$eval22350$fn__22351$fn__22352@11ad162d"</span>]</span></code></pre></div>
</div>
<p>Yikes! what an eyesore. This is not an academic issue specific to lambda calculus. Any function created from inside a function is helpfully identifiable through the <code>fn$fn</code> nesting. We create these quite regularly, and they are often printed in stack traces. I’m sure you have seen them when you map an inline function across a seq, and there is a bug in the anonymous function.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb11-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> caesar-cipher </span>[s]</span>
<span id="cb11-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mapv</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> add2 [x] (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> x)) s))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb12-1">(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span> (caesar-cipher <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hello world"</span>)</span>
<span id="cb12-2">     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">catch</span> Exception ex</span>
<span id="cb12-3">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vec</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">take</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> (.getStackTrace ex)))))</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb13-1">[[clojure.lang.Numbers add <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Numbers.java"</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">155</span>]</span>
<span id="cb13-2"> [clojure.lang.Numbers add <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Numbers.java"</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3747</span>]</span>
<span id="cb13-3"> [clojure.print_object.remove_extraneous$caesar_cipher$add2__22358 invoke <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NO_SOURCE_FILE"</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb13-4"> [clojure.core$mapv$fn__8565 invoke <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"core.clj"</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7059</span>]]</span></code></pre></div>
</div>
<p>See that part <code>caesar_cipher$add2</code>? That is <strong>very</strong> useful information. It tells us that the exception was inside <code>add2</code>, which is inside <code>caesar-cipher</code>. The stack trace doesn’t print functions as objects, I’m just pointing out that the thing that we care about for functions is really just that they are a function, what their name is, and whether they were created from inside another function. Let’s go back to why printing a function as an object. An easy improvement is to demunge from Java names to Clojure names. Demunging converts <code>_</code> to <code>-</code> and <code>$</code> to <code>/</code>, and munged characters like <code>+</code> which is <code>PLUS</code> in Java.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb14-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> class-name</span></span>
<span id="cb14-2">  [x]</span>
<span id="cb14-3">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-&gt;</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> .getName Compiler/demunge))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb15-1">(class-name ((<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [] (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [y] y))))</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb16-1"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clojure.print-object.remove-extraneous/eval22364/fn--22365/fn--22366"</span></span></code></pre></div>
</div>
<p>Next, we don’t need the eval identities.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb17-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> remove-extraneous</span></span>
<span id="cb17-2">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Clojure compiles with unique names that include things like `/eval32352/` and `--4321`.</span></span>
<span id="cb17-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  These are rarely useful when printing a function.</span></span>
<span id="cb17-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  They can still be accessed via (class x) or similar."</span></span>
<span id="cb17-5">  [s]</span>
<span id="cb17-6">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-&gt;</span> s</span>
<span id="cb17-7">      (str/replace <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">#"/eval\d+/"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>)</span>
<span id="cb17-8">      (str/replace <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">#"--\d+(/|$)"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$1"</span>)))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb18-1">(remove-extraneous (class-name ((<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [] (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [y] y)))))</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb19-1"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clojure.print-object.remove-extraneous/fn/fn"</span></span></code></pre></div>
</div>
<p>Much nicer. I can actually read that! I’m not particularly fond of the long namespace shown, and multiple slashes form invalid symbols, so I prefer using $ as the name level delimiter.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb20-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> format-class-name </span>^String [s]</span>
<span id="cb20-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [[ns-str &amp; names] (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-&gt;</span> (remove-extraneous s)</span>
<span id="cb20-3">                             (str/split <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">#"/"</span>))]</span>
<span id="cb20-4">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> ns-str names)</span>
<span id="cb20-5">      (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">str</span> (str/join <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$"</span> names))</span>
<span id="cb20-6">      (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-&gt;</span> s (str/split <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">#"\."</span>) (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">last</span>)))))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb21-1">(format-class-name (remove-extraneous (class-name ((<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [] (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [y] y))))))</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb22-1"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fn$fn"</span></span></code></pre></div>
</div>
<p>So short, so sweet. If it’s a function, why call it an object?</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb23-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> object-str </span>^String [x]</span>
<span id="cb23-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">str</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn?</span> x) <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#fn"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#object"</span>)</span>
<span id="cb23-3">       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" ["</span> (format-class-name (class-name x)) <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"]"</span>))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb24-1">(object-str ((<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [] (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [y] y))))</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb25-1"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#fn [fn$fn]"</span></span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb26-1">(object-str (async/chan))</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb27-1"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#object [ManyToManyChannel]"</span></span></code></pre></div>
</div>
<p>This is really all I care to know about when printing objects and functions, and it matters inside notebooks, where we want to print things, eval things that return objects and functions, and datafy complex objects that contain other objects. To print things without knowing if they are objects, functions, or data, we can extend Clojure’s <code>print-method</code>.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb28-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defmethod</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> print-method </span>Object [x ^Writer w]</span>
<span id="cb28-2">  (.write w (object-str x)))</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb29-1">#object [MultiFn]</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb30-1">((<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [] (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [y] y)))</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb31-1">#fn [fn$fn]</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb32-1">(async/chan)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb33-1">#object [ManyToManyChannel]</span></code></pre></div>
</div>
<p>You can require this namespace from other notebooks to turn on this nice, concise mode of object printing.</p>
<p>Happy notebooking!</p>
<div style="background-color:grey;height:2px;width:100%;"></div>
<div><pre><small><small>source: <a href="https://github.com/ClojureCivitas/clojurecivitas.github.io/blob/main/notebooks/clojure/print_object/remove_extraneous.clj">notebooks/clojure/print_object/remove_extraneous.clj</a></small></small></pre></div>



 ]]></description>
  <guid>https://clojurecivitas.github.io/clojure/print_object/remove_extraneous.html</guid>
  <pubDate>Thu, 05 Jun 2025 00:00:00 GMT</pubDate>
</item>
<item>
  <title>The Hallway Track: SciNoj Light #1 Data Analysis Stories</title>
  <dc:creator>Timothy Pratley</dc:creator>
  <link>https://clojurecivitas.github.io/conferences/scinoj_light_1/notes/hallway_track.html</link>
  <description><![CDATA[ 





<p>The <a href="https://scicloj.github.io/scinoj-light-1">SciNoj Light #1</a> Conference brought together Clojure enthusiasts, data scientists, and researchers for an engaging exploration of data analysis stories. The event fostered a collaborative, informal atmosphere where participants exchanged ideas across disciplines from cognitive psychology to urban planning.</p>
<p>If you missed it, you can view the talks on the <a href="https://www.youtube.com/playlist?list=PLb_VRZPxjMAAaoAPnk8ClWET3baRV1Whv">conference sessions playlist</a>. The <a href="https://scicloj.github.io/scinoj-light-1/speakers.html">conference website</a> has detailed information about the talks and speakers. Links to the notebook code presented are on the <a href="https://scicloj.github.io/scinoj-light-1/sessions">sessions page</a>, and available as data in the <a href="https://github.com/scicloj/scinoj-light-1/blob/main/info.edn">info.edn file</a>.</p>
<p>The <a href="https://youtu.be/3HZ5rngHzWM">concluding talk on lane reductions</a> stood out as my favorite because it blended data-driven insights with relatable, human-interest storytelling. As a cyclist, I immediately connected with how lane reductions and protected bike lanes are impactful to my safety. The talk’s compelling visuals, grounded in real case studies, made the story very tangible. Heather’s personal perspective as a car-free parent added emotional weight. She illustrated how community advocacy and smart urban design saves lives, and makes more livable spaces. The mix of passion, rigor, and optimism left me inspired; data analysis can drive tangible, life-improving change.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://clojurecivitas.github.io/conferences/scinoj_light_1/notes/crashes.png" class="img-fluid figure-img"></p>
<figcaption>Bike lane improvements reduce crashes</figcaption>
</figure>
</div>
<p>A major focus of the conference was the development of Clojure’s data science <a href="https://github.com/scicloj/noj">Noj</a> toolkit. This suite of libraries demonstrated how Clojure combines functional programming elegance with practical performance. Speakers highlighted Noj’s interoperability with Python and Java ecosystems while emphasizing its advantages for reproducible and maintainable workflows. The community’s collaborative energy was evident throughout.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://clojurecivitas.github.io/conferences/scinoj_light_1/notes/noj_components.png" class="img-fluid figure-img"></p>
<figcaption>Noj core components</figcaption>
</figure>
</div>
<p>Artificial intelligence emerged as a recurring theme, with several talks exploring hybrid approaches to enhance reliability. One discussion centered on Retrieval-Augmented Generation (RAG) systems, where combining large language models with Clojure’s logic programming capabilities could improve accuracy in structured domains like government Q&amp;A. Another session delved into probabilistic programming with Inferme, illustrating Bayesian methods for modeling uncertainty. These technical deep dives were balanced by ethical considerations and reflections on technology’s societal implications.</p>
<p>Scientific applications showcased Clojure’s versatility. One talk explored simulating fluid dynamics. Another focused on forecasting tropical cyclone paths using physics-informed machine learning. Cognitive science experiments were also featured, using collaborative games and puzzles to study human planning behavior, and brain wave monitors. The conference also highlighted social impact work, such as data-driven advocacy for safer street designs, proving that technical tools can drive urban change.</p>
<p>What stood out to me was how effectively the SciCloj community uses Clojure notebooks for collaborative work. Presenters shared their research through executable notebooks that cleanly combined code, visualizations and explanations. It’s a practical pattern broadly applicable for sharing ideas and knowledge.</p>
<p>Throughout the event, a sense of optimism prevailed about Clojure’s untapped potential. While acknowledging gaps in ML tooling compared to Python, speakers demonstrated that Clojure’s functional rigor and JVM scalability make it a good fit for data science. Attendee discussions envisioned collaborating further on logic-guided AI and semantic web ontologies. There was a recurring theme of bridging the gap between academic theory and real-world engineering. SciNoj Light ultimately painted a picture of Clojure not just as a language, but as a catalyst for interdisciplinary innovation.</p>
<blockquote class="blockquote">
<p>You can have the cake of Clojure’s immutable persistent data structures and eat it too;<br>
Get your answers fast and make your customers happy.<br>
— Harold</p>
</blockquote>
<p>A big thank you to the organizers! The event was an overwhelming success with high quality presentations and valuable discussions. I’m looking forward to the next SciNoj, it’s a rare and valuable blend of science, technology, community and code.</p>
<p>Below are my notes about the sessions and conversations from the conference.</p>
<section id="pre-conference-interview" class="level3">
<h3 class="anchored" data-anchor-id="pre-conference-interview">Pre-conference interview</h3>
<p>Engaging to have a taste of what’s to come, got me really enthusiastic about the coming event. Game as a Research Tool: “Tik Tik” is a controlled environment for studying human cognition and collaboration. Combines cognitive psychology, game design, and data analysis.</p>
</section>
<section id="hello" class="level3">
<h3 class="anchored" data-anchor-id="hello">1.1: Hello</h3>
<p>Community-driven event. Informal, interactive, and welcoming. Focus on Clojure for data workflows. Tools and libraries have matured, and the conference shares these advancements. <a href="https://www.clojurians-zulip.org/">Zulip</a> is the main forum, attendees are encouraged to engage via structured topic threads. The macroexpand session invites ideas for expanding Clojure adoption in various fields. Hosts encourage questions, jokes, and relaxed participation. Sets the tone for an inclusive, engaging, and slightly nerdy gathering of Clojure enthusiasts.</p>
</section>
<section id="an-intro-to-the-noj-toolkit" class="level3">
<h3 class="anchored" data-anchor-id="an-intro-to-the-noj-toolkit">1.2: An intro to the Noj toolkit</h3>
<p>Noj is a Clojure-based data science toolkit integrating libraries for data analysis, visualization, and machine learning. Designed for functional, efficient data processing with compatibility across libraries (e.g., Tablecloth, FastMath, Metamorph). Inspired by tools like R’s dplyr/ggplot and Python’s pandas/Plotly, but with a Clojure-centric approach. Tablecloth for tabular data manipulation (similar to pandas/dplyr). TablePlot grammar-of-graphics-inspired visualization (like ggplot). FastMath stats and statistical modeling (logistic regression and more). Metamorph for machine learning workflows. Worked example of predicting success in Kickstarter projects. Data loading/cleaning, exploratory analysis (grouping, aggregation, bar plots), predictive modeling, evaluation (train/test split, accuracy checks). Functional &amp; Immutable, Noj leverages Clojure’s strengths. Efficient columnar storage with zero-copy operations.</p>
</section>
<section id="probability-and-statistics---daniel-slutsky" class="level3">
<h3 class="anchored" data-anchor-id="probability-and-statistics---daniel-slutsky">1.3: Probability and statistics - Daniel Slutsky</h3>
<p>Generating pseudo-random numbers using seeds for reproducibility in research. Simulating dice rolls to explore distributions. Used histograms and scatter plots to visualize distributions. Computed mean, standard deviation and z-scores for comparison. Bayesian inference for probabilistic models with parameters. Conditioned models on observed data to infer posterior distributions. Highlighted constraints and efficient sampling algorithms. Avoid lazy sequences for large simulations; consider dtype-next or transducers. Visualization matters, histograms and scatter plots reveal patterns. Probabilistic programming models uncertainty and updates beliefs with data. Balanced foundational stats with advanced topics, emphasizing Clojure’s tools for data science.</p>
</section>
<section id="customer-churn-analysis-llms-logic-programming---siavash-mohammady" class="level3">
<h3 class="anchored" data-anchor-id="customer-churn-analysis-llms-logic-programming---siavash-mohammady">1.4: Customer churn analysis, LLMs &amp; logic programming - Siavash Mohammady</h3>
<p>Customers leaving significantly impacts revenue. Exploring factors like course format, teacher experience, and registration patterns. High churn in early months, newer teachers correlated with higher churn. User prompt → NLP entity recognition → LLM generates high-level DSL → Clara rule engine translates to low-level DSL → Execution. Mentorship for new teachers can reduce churn. Pairing LLMs abstract reasoning with logic engines concrete execution optimizes complex data tasks. A forward-looking talk blending data science, AI, and Clojure, emphasizing doing less.</p>
</section>
<section id="linear-foundations-nonlinear-frontiers---jelena-losic" class="level3">
<h3 class="anchored" data-anchor-id="linear-foundations-nonlinear-frontiers---jelena-losic">1.5: Linear Foundations &amp; Nonlinear Frontiers - Jelena Losic</h3>
<p>Linear systems rely on superposition, the whole is the sum of parts. Vector spaces, linear regression, Fourier analysis. Real-world systems are often nonlinear. Linear methods fail when data lies on curved manifolds or exhibits complex interactions. Techniques like t-SNE, UMAP, and autoencoders handle nonlinearity by preserving structures or learning manifold geometry. Nonlinear systems can be deterministic yet unpredictable. Nonlinear methods unlock richer patterns but sacrifice interpretability and require more data. Dimensionality reduction illustrates the trade-off between simplicity and accuracy. Embeddings leverage linear algebra but rely on nonlinear transformations for deeper semantics.</p>
</section>
<section id="raggedy-anns-big-adventure---paula-gearon" class="level3">
<h3 class="anchored" data-anchor-id="raggedy-anns-big-adventure---paula-gearon">1.6: RAGgedy Ann’s Big Adventure - Paula Gearon</h3>
<p>Vectors represent concepts in multidimensional space. Embeddings convert text into vectors, capturing meaning. Similarity between vectors is measurable. Neural networks process inputs through weighted connections and activation functions. Transformers contextualize words in sentences. Combining LLMs with vector databases to reduce hallucinations. Augmenting queries with retrieved context. LLMs are built from modular math operations. Vector databases enable semantic search. RAG improves accuracy by grounding LLM outputs in verified data.</p>
</section>
<section id="parliamentary-questions---rag-evaluation---eoin-carney" class="level3">
<h3 class="anchored" data-anchor-id="parliamentary-questions---rag-evaluation---eoin-carney">1.7: Parliamentary Questions - RAG Evaluation - Eoin Carney</h3>
<p>Can RAG effectively answer parliamentary style questions using Irish government data? 10k publicly available Irish parliamentary questions and answers. Compared sentence-based chunking with full document retrieval. Tested multiple LLMs for generation and evaluation. Retrieval Matters More Than Prompting. Smaller, precise chunks of 3–5 sentences improved precision over full document retrieval. Direct answer retrieval outperformed matching questions to answers. Deterministic metrics like word overlap failed to capture nuance. LLM as judge worked better for correctness. Clay notebook visualization helped explore vector embeddings interactively. Government answers should be plain and factual. LLMs are oddly well-suited for that.</p>
</section>
<section id="discussion-rags-and-structured-knowledge" class="level3">
<h3 class="anchored" data-anchor-id="discussion-rags-and-structured-knowledge">1.8 - Discussion: RAGs and Structured Knowledge</h3>
<p>Shared experiences using Clojure for AI projects. Exploring logic programming as a superset of reasoning techniques and unifying them with embeddings and vector logic. Foundational ontologies and their role in structuring knowledge for AI, particularly in medical domains. The conversation fluidly shifted from technical to philosophical and practical.</p>
</section>
<section id="noj-deep-dive---harold-daniel-slutsky" class="level3">
<h3 class="anchored" data-anchor-id="noj-deep-dive---harold-daniel-slutsky">1.9: Noj Deep Dive - Harold &amp; Daniel Slutsky</h3>
<p>Using Clojure for functional data science, contrasting it with Python tools like Pandas. The focus is on immutability, performance, and leveraging Clojure’s strengths for data processing. Tech.ml.dataset for tabular data processing. Columnar storage for efficiency and integrates with other libraries in the ecosystem. Layered Architecture. Hamfisted high-performance, immutable collections optimized for JVM memory/CPU. Dtype-next array random access and lazy, non-caching transformations. Tablecloth high-level tabular data tools built atop these foundations. Challenges and solutions for integrating with Python via libpython-clj and stdlang. Hamfisted and Dtype-next enable Clojure to match Java/Python performance while retaining functional idioms. 20x speedup in lazy sequences. Columnar storage in TMD reduces memory overhead. Libraries like FastMath, MetamorphML, and Tableplot extend the stack. Real-world applications in consulting and open-source collaboration. Frequent shoutouts to contributors and emphasis on community input via Zulip. If you think data science needs software engineering, you’re right. A blend of technical rigor, community spirit, and practical focus on building scalable, functional data tools.</p>
</section>
<section id="brain-data-in-clojure---lorelai-lyons" class="level3">
<h3 class="anchored" data-anchor-id="brain-data-in-clojure---lorelai-lyons">1.10: Brain data in Clojure - Lorelai Lyons</h3>
<p>Ethical and Historical Context of Brain-Computer Interfaces. Morally questionable history of neuroscience. Need for ethical considerations in modern BCIs. The goal is to bridge the gap between continuous human thought and discrete computing. Neurons generate electrical signals that can be recorded and digitized. EEG measures brainwave frequencies via electrodes placed on the scalp. EEG data from a motor imagery study. Applied filters to isolate frequency bands. Developing a low-cost binary file system for efficient EEG data storage. Exploring brain-controlled interfaces for creative applications. Consumer EEG devices make brain data collection feasible for programmers. BCIs require collaboration across neuroscience, hardware, and software. Mixed technical depth with ethical reflection.</p>
</section>
<section id="d-viscous-fluid-flow-data-analysis-burgers-equation---siyoung-byun" class="level3">
<h3 class="anchored" data-anchor-id="d-viscous-fluid-flow-data-analysis-burgers-equation---siyoung-byun">2.1: 1D Viscous Fluid Flow Data Analysis, Burgers’ Equation - Siyoung Byun</h3>
<p>Fluid dynamics is complex, involving variables like friction, pressure, and momentum. CFD uses computational methods to simulate fluid behavior, crucial for fields like aerospace, healthcare, and astrophysics. Astrophysics simulations of binary star collisions use CFD. Burgers’ Equation combines nonlinear convection (steepening fluid motion) and viscosity (smoothing/diffusion). Demonstrated via simulations of a shock in a 1D fluid, visualized over time. Used mutable Java arrays for performance. Extending to 2D/3D simulations and incorporate the Navier-Stokes equations for full fluid dynamics. Visualization Matters. Plotting data is critical for interpreting simulations. Siyoung emphasizes the learning process and invites collaboration. Technical but accessible, viscosity effects are explained with analogies. Passion for both astrophysics, fluid dynamics and Clojure shines through. Simulations of white dwarf collisions brought home the realization that star interactions are fluid. Korean ondol floor heating as an analogy for convection.</p>
</section>
<section id="uk-electricity-demand-time-series-forecasting---anton-lobach" class="level3">
<h3 class="anchored" data-anchor-id="uk-electricity-demand-time-series-forecasting---anton-lobach">2.2: UK Electricity Demand Time Series Forecasting - Anton Lobach</h3>
<p>The Taylor dataset contains electricity demand in Wales/England. Extract day of week, minute of day, weekend flag. Ridge regression regularized linear regression to prevent overfitting. Use rolling origin cross-validation. Root Mean Squared Error to measure forecast accuracy. Clojure has expressive, modular workflows with strong data processing capabilities. Seasonality matters. Minute-of-day was the most predictive feature. Ridge regression achieved reasonable accuracy. Split data into train/test sets before exploratory analysis to avoid bias. Use rolling windows for temporal data. The tutorial is available as an interactive notebook.</p>
</section>
<section id="tropical-cyclone-trajectory-modelling---k-ram-narayan-naimish-mani-b" class="level3">
<h3 class="anchored" data-anchor-id="tropical-cyclone-trajectory-modelling---k-ram-narayan-naimish-mani-b">2.3: Tropical cyclone trajectory modelling - K Ram Narayan, Naimish Mani B</h3>
<p>Accurate trajectory forecasting is crucial for disaster preparedness, evacuation planning, and minimizing loss of life and property. Forecasting relies on a mix of satellite data, computer simulations, and aircraft reconnaissance. Using SINDy (Sparse Identification of Nonlinear Dynamics), to extract governing equations from cyclone trajectory data to predict future paths. Global cyclone track dataset. Satellite imagery used to compute wind velocity and shear via optical flow. Incorporates cyclone dynamics to refine SINDy’s candidate equations. Cyclone movement is driven by steering winds, Coriolis force, beta drift, and interactions with pressure systems. Collect trajectory and satellite data. Construct a candidate library of possible dynamical terms. Use Lasso regression to sparsely select the most relevant terms. Derive interpretable differential equations for forecasting. SINDy achieved a 43.71 km mean absolute error, acceptable in cyclone forecasting. Outperformed by gradient boosting, and random forest in single-step prediction but excels in full trajectory forecasting. Bay of Bengal cyclones curve unpredictably due to land effects. Bridges meteorology, physics, and machine learning for cyclone prediction.</p>
</section>
<section id="studying-planning-with-a-novel-video-game---cvetomir-dimov" class="level3">
<h3 class="anchored" data-anchor-id="studying-planning-with-a-novel-video-game---cvetomir-dimov">2.4: Studying planning with a novel video game - Cvetomir Dimov</h3>
<p>Planning is a fundamental cognitive ability used in everyday tasks. “Tik Tik” game is designed to study planning. Players control a fireball and an ice cube that must collaborate to navigate obstacles and reach targets. A custom program was developed to generate and solve game levels, identifying optimal paths and measuring problem difficulty. Goal is to understand what incentivizes planning. Difficulty influenced by the number of barriers and their intersections. Problem difficulty predictors were the minimum moves needed and the number of possible paths up to the optimal length. Study 1 high dropout rates, large individual differences in planning ability. Study 2 time limits and stricter move limits reduced dropouts and reinforced planning incentives. Tight constraints encourage planning. Problem difficulty can be systematically manipulated for cognitive research. Demonstrations of the game and solver make abstract concepts tangible. Credits multiple software tools, emphasizing a community-driven approach to research.</p>
</section>
<section id="building-a-data-science-ecosystem-in-clojure---kira-howe" class="level3">
<h3 class="anchored" data-anchor-id="building-a-data-science-ecosystem-in-clojure---kira-howe">2.5: Building a Data Science Ecosystem in Clojure - Kira Howe</h3>
<p>Inspiration from the Tidyverse (R). A cohesive ecosystem with shared design principles on data and composable tools. Standardized data structures and streamline workflows. Fragmented tools create glue code overhead. Immutable data and pure functions enable reproducibility. JVM handles large-scale data efficiently. Engineering culture emphasis on stability and interoperability. Explosive data growth demands scalable, deterministic tools. Noj as a Clojure based ecosystem inspired by Tidyverse but optimized for scalability and engineering. Simplify onboarding through Jupyter support and Clojure in a box. Need for Shiny-like tools for rapid prototyping. Emphasized grassroots community building and learning together. Data quality should be a philosophy, not an afterthought.</p>
</section>
<section id="macroexpand-1" class="level3">
<h3 class="anchored" data-anchor-id="macroexpand-1">2.6: Macroexpand-1</h3>
<p>Ways to broaden Clojure’s impact beyond its traditional domains by fostering interdisciplinary collaboration. Need to make Clojure more accessible and visible in fields like data science, education, and specialized industries. Improve tooling, documentation, and community outreach. Developer intuitive libraries, enhancing interoperability with other languages. Lowering barriers for newcomers. Importance of geospatial analysis and modern programming practices. Sustainable community efforts and cross-disciplinary knowledge sharing.</p>
</section>
<section id="the-impact-of-lane-reductions---heather-moore-farley" class="level3">
<h3 class="anchored" data-anchor-id="the-impact-of-lane-reductions---heather-moore-farley">2.7: The Impact of Lane Reductions - Heather Moore-Farley</h3>
<p>Reducing car lanes, protected bike lanes, and pedestrian crossings decrease traffic injuries and fatalities. California’s crash data used to visualize collision hotspots to push for safer street redesigns. High injury corridors 6% of streets cause 60% of severe/fatal crashes. Correlated lane reductions, protected bike lanes, and raised bus stops led to fewer crashes over time. Local groups use data to advocate for safer streets. Police reported crash data has missing ages, locations and underreporting driver fault. Heather shares her lived experience as a car-free parent in Oakland, tying data to safety. Design solutions and community action work. Advocating for upcoming redesigns. A compelling mix of data science, urbanism, and grassroots advocacy. Number crunching can drive tangible change.</p>


</section>

 ]]></description>
  <guid>https://clojurecivitas.github.io/conferences/scinoj_light_1/notes/hallway_track.html</guid>
  <pubDate>Wed, 28 May 2025 00:00:00 GMT</pubDate>
  <media:content url="https://clojurecivitas.github.io/conferences/scinoj_light_1/notes/noj_components.png" medium="image" type="image/png" height="75" width="144"/>
</item>
<item>
  <title>Factorization of Eratosthenes</title>
  <dc:creator>Tim Schafer</dc:creator>
  <link>https://clojurecivitas.github.io/math/primes/factorization/sieve_augmented.html</link>
  <description><![CDATA[ 





<style></style>
<style>.printedClojure .sourceCode {
  background-color: transparent;
  border-style: none;
}
</style>
<style>.clay-limit-image-width .clay-image {max-width: 100%}
.clay-side-by-side .sourceCode {margin: 0}
.clay-side-by-side {margin: 1em 0}
</style>
<script src="math/primes/factorization/sieve_augmented_files/md-default0.js" type="text/javascript"></script>
<script src="math/primes/factorization/sieve_augmented_files/md-default1.js" type="text/javascript"></script>
<p>Adapts the <a href="https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Sieve of Eratosthenes</a> to prime factorize numbers through <code>n</code>.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb1-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> prime-factors </span>[n]</span>
<span id="cb1-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reduce</span></span>
<span id="cb1-3">   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [factors prime]</span>
<span id="cb1-4">     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">count</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">nth</span> factors prime)))</span>
<span id="cb1-5">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reduce</span></span>
<span id="cb1-6">        (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [factors multiple]</span>
<span id="cb1-7">          (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [[composite-divisor <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:as</span> divisors] (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">nth</span> factors multiple)]</span>
<span id="cb1-8">            (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;</span> prime composite-divisor)</span>
<span id="cb1-9">              (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [remaining-divisor (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">/</span> composite-divisor prime)</span>
<span id="cb1-10">                    remaining-divisors (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">nth</span> factors remaining-divisor)</span>
<span id="cb1-11">                    prime-divisors (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">cons</span> prime (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">rest</span> divisors))]</span>
<span id="cb1-12">                (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assoc</span></span>
<span id="cb1-13">                 factors multiple</span>
<span id="cb1-14">                 (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">count</span> remaining-divisors))</span>
<span id="cb1-15">                   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">concat</span> remaining-divisors prime-divisors)</span>
<span id="cb1-16">                   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">cons</span> remaining-divisor prime-divisors))))</span>
<span id="cb1-17">              factors)))</span>
<span id="cb1-18">        factors</span>
<span id="cb1-19">        (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">range</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">*</span> prime prime) (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">inc</span> n) prime))</span>
<span id="cb1-20">       factors))</span>
<span id="cb1-21">   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mapv</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">list</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">range</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">inc</span> n)))</span>
<span id="cb1-22">   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">range</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">inc</span> (m/sqrt n)))))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb2-1">(prime-factors <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb3-1">[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb3-2"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-3"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-4"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb3-5"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-6"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb3-7"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-8"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb3-9"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-10"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb3-11"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-12"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)</span>
<span id="cb3-13"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-14"> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)]</span></code></pre></div>
</div>
<div style="background-color:grey;height:2px;width:100%;"></div>
<div><pre><small><small>source: <a href="https://github.com/ClojureCivitas/clojurecivitas.github.io/blob/main/notebooks/math/primes/factorization/sieve_augmented.clj">notebooks/math/primes/factorization/sieve_augmented.clj</a></small></small></pre></div>



 ]]></description>
  <guid>https://clojurecivitas.github.io/math/primes/factorization/sieve_augmented.html</guid>
  <pubDate>Wed, 28 May 2025 00:00:00 GMT</pubDate>
</item>
<item>
  <title>The Z-Combinator Gambit</title>
  <dc:creator>Chris Houser</dc:creator>
  <dc:creator>Timothy Pratley</dc:creator>
  <link>https://clojurecivitas.github.io/code_interview/beating/with_stupid_stuff/z_combinator_gambit.html</link>
  <description><![CDATA[ 





<style></style>
<style>.printedClojure .sourceCode {
  background-color: transparent;
  border-style: none;
}
</style>
<style>.clay-limit-image-width .clay-image {max-width: 100%}
.clay-side-by-side .sourceCode {margin: 0}
.clay-side-by-side {margin: 1em 0}
</style>
<script src="code_interview/beating/with_stupid_stuff/z_combinator_gambit_files/md-default0.js" type="text/javascript"></script>
<script src="code_interview/beating/with_stupid_stuff/z_combinator_gambit_files/md-default1.js" type="text/javascript"></script>
<p>Welcome back code champs, number ninjas, and data divers to our first episode of Beating Code Interviews with Stupid Stuff. People often send me emails asking, “How can I use lambda calculus to impress people?” Today, we find out.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://clojurecivitas.github.io/code_interview/beating/with_stupid_stuff/z-combinator.jpg" class="img-fluid figure-img"></p>
<figcaption>Programmer staring at Z-combinator</figcaption>
</figure>
</div>
<p>I have an interview with ZCorp lined up in 5 minutes, and our challenge is to only use anonymous functions. No defn, no loops, and definitely no self-reference. I’ll allow myself the occasional def for brevity, but beyond that, we’ll be running on pure lambda calculus.</p>
<p><strong>20 minutes later</strong></p>
<blockquote class="blockquote">
<p>Hey, sorry to keep you waiting. I just got out of a more important meeting. I’m kind of a big deal here at ZCorp. Why don’t you tell me a <em>little</em> bit about yourself?</p>
</blockquote>
<p>Born of binary, raised on algorithms, I walk the path of lambda…</p>
<blockquote class="blockquote">
<p>Riiiight… Let’s just start with the warm-up problem. Show me how you would reverse a list.</p>
</blockquote>
<p>Ah, the timeless list reversal. Deceptively simple, perilously deep. We must first define our purpose.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb1-1">(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [SELF LIST])</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb2-1">#object [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span>]</span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>We’re just writing a function, and it only needs to take a list…</p>
</blockquote>
<p>Not just any function, my friend, but one that knows itself. To know yourself is to find your fixed point.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb3-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> REV</span></span>
<span id="cb3-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [SELF LIST]</span>
<span id="cb3-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">empty?</span> LIST)</span>
<span id="cb3-4">      []</span>
<span id="cb3-5">      (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">conj</span> (SELF SELF (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">rest</span> LIST))</span>
<span id="cb3-6">            (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">first</span> LIST)))))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb4-1">(REV REV [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb5-1">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
</div>
<p><code>SELF</code> is an input to itself, the logic of reversal.</p>
<blockquote class="blockquote">
<p>Ok let’s just move on to the next problem, creating a Fibonacci sequence.</p>
</blockquote>
<p>Oh no, our definition of reverse is intertwined with recursion. Let’s factor that out:</p>
<p>We need to lift our <code>SELF</code></p>
<div class="sourceClojure">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb6-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> REV'</span></span>
<span id="cb6-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [SELF]</span>
<span id="cb6-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [LIST]</span>
<span id="cb6-4">      (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">empty?</span> LIST)</span>
<span id="cb6-5">        []</span>
<span id="cb6-6">        (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">conj</span> (SELF (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">rest</span> LIST))</span>
<span id="cb6-7">              (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">first</span> LIST))))))</span></code></pre></div>
</div>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb7-1">((REV' REV') [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])</span></code></pre></div>
<p><strong>error</strong></p>
<p>Oh, no… <code>SELF</code> doesn’t take <code>LIST</code>, it’s a function that returns a function that operates on <code>LIST</code>, and the argument to <code>SELF</code> is… <code>SELF</code>. Therefore, we need to give it <code>(SELF SELF)</code>.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb8-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> REV''</span></span>
<span id="cb8-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [SELF]</span>
<span id="cb8-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [LIST]</span>
<span id="cb8-4">      (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">empty?</span> LIST)</span>
<span id="cb8-5">        []</span>
<span id="cb8-6">        (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">conj</span> ((SELF SELF) (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">rest</span> LIST))</span>
<span id="cb8-7">              (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">first</span> LIST))))))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb9-1">((REV<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">''</span> REV<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">''</span>) [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb10-1">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>That’s a confusing way to write it</p>
</blockquote>
<p>Quite right, because it’s not obvious what <code>(SELF SELF)</code> is. We need to extract it out. What we want is:</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb11-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> REV-LOGIC</span></span>
<span id="cb11-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [SELF]</span>
<span id="cb11-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [LIST]</span>
<span id="cb11-4">      (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">empty?</span> LIST)</span>
<span id="cb11-5">        []</span>
<span id="cb11-6">        (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">conj</span> (SELF (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">rest</span> LIST))</span>
<span id="cb11-7">              (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">first</span> LIST))))))</span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>Believe me when I say that is not what I meant…</p>
</blockquote>
<p>Oh, right. Now <code>SELF = (SELF SELF)</code>.</p>
<blockquote class="blockquote">
<p>Not what I meant, and also that sounds impossible.</p>
</blockquote>
<p>But identity is the identity of itself:</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb12-1">(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">identity</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb13-1"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb14-1">((<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">identity</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">identity</span>) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb15-1"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>O.K. sure, but that’s a special case.</p>
</blockquote>
<div class="sourceClojure">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb16-1">(((<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">identity</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">identity</span>) (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">identity</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">identity</span>)) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb17-1"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>This is an identity crisis.</p>
</blockquote>
<p>We just need to find the right conditions for <code>(SELF SELF) = SELF</code>.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb18-1">(REV-LOGIC REV-LOGIC)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb19-1">#object [REV-LOGIC$fn]</span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>Well, it’s a function! That much is clear…</p>
</blockquote>
<p>But it doesn’t work, because <code>(REV-LOGIC REV-LOGIC) =/= REV-LOGIC.</code> Let’s try something easier:</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb20-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> FIX</span></span>
<span id="cb20-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [LOGIC]</span>
<span id="cb20-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; return something like identity where self application does not change it</span></span>
<span id="cb20-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#_</span>FIXED))</span></code></pre></div>
</div>
<p><code>FIX</code> takes the logic function, and makes a function such that <code>(FIXED (FIX LOGIC)) = FIXED</code></p>
<p><code>(FIXED FIXED) =&gt; FIXED</code> which means that <code>((FIX LOGIC) (FIX LOGIC)) = (FIX LOGIC)</code></p>
<blockquote class="blockquote">
<p>Right, that sounds way easier… <strong>shaking head in disbelief</strong></p>
</blockquote>
<p>Exactly! Because we just reverse it: <code>(FIX F) = ((FIX F) (FIX F))</code></p>
<blockquote class="blockquote">
<p>Why did you call it <code>FIX</code>?</p>
</blockquote>
<p>Well, it was broken before right?</p>
<blockquote class="blockquote">
<p>I’m starting to think that you are the broken one.</p>
</blockquote>
<div class="sourceClojure">
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb21-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> FIX</span></span>
<span id="cb21-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [LOGIC]</span>
<span id="cb21-3">    ((FIX LOGIC) (FIX LOGIC))))</span></code></pre></div>
</div>
<p>But <code>FIX</code> can still see itself. We need to parameterize the use of <code>FIXED</code></p>
<div class="sourceClojure">
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb22-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> FIX</span></span>
<span id="cb22-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [LOGIC]</span>
<span id="cb22-3">    ((<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [FIXED]</span>
<span id="cb22-4">       (LOGIC (FIXED FIXED)))</span>
<span id="cb22-5">     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [FIXED]</span>
<span id="cb22-6">       (LOGIC (FIXED FIXED))))))</span></code></pre></div>
</div>
<p>There, I fixed it.</p>
<blockquote class="blockquote">
<p>What is fixed?</p>
</blockquote>
<p><code>FIXED</code> is <code>(FIXED FIXED)</code>, obviously.</p>
<blockquote class="blockquote">
<p>Obviously. <strong>raises hands in dispair</strong></p>
</blockquote>
<p>Because <code>(FIX F) = ((FIX F) (FIX F))</code>, it was your idea to refactor remember?</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb23-1">(FIX REV-LOGIC)</span></code></pre></div>
<p><strong>stack overflow</strong></p>
<blockquote class="blockquote">
<p>Everything looks to be inside out now.</p>
</blockquote>
<p>Oh, you are right, we can’t pass <code>(FIXED FIXED)</code> as an argument because it will be evaluated first. Thanks for the tip.</p>
<blockquote class="blockquote">
<p>Can we fix it? <strong>slaps self</strong></p>
</blockquote>
<p>Instead of calling <code>(FIXED FIXED)</code> we need a function that will create <code>(FIXED FIXED)</code> when it’s needed, after <code>LOGIC</code> gets called. <code>LOGIC</code> needs to take itself as it’s argument, so the function we pass to <code>LOGIC</code> should look very much like <code>LOGIC</code>, but of course without any actual logic in it.</p>
<blockquote class="blockquote">
<p>That actually sounds logical.</p>
</blockquote>
<p><code>LOGIC</code> is a function of itself, returning a function that acts on a value:</p>
<blockquote class="blockquote">
<p>didn’t you say that <code>(FIXED FIXED) = FIXED</code>?</p>
</blockquote>
<p>Yes but only after we <code>FIX</code> it. Fixing it requires us to go from <code>FIXED</code> to <code>(FIXED FIXED)</code> remember?</p>
<blockquote class="blockquote">
<p>Ah sure…</p>
</blockquote>
<p>So while we are fixing logic, let’s replace <code>(LOGIC (FIXED FIXED))</code> with our deferring function.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb24-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> FIX</span></span>
<span id="cb24-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [LOGIC]</span>
<span id="cb24-3">    ((<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [FIXED]</span>
<span id="cb24-4">       (LOGIC (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> SELF [VALUE]</span>
<span id="cb24-5">                ((FIXED FIXED) VALUE))))</span>
<span id="cb24-6">     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [FIXED]</span>
<span id="cb24-7">       (LOGIC (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> SELF [VALUE]</span>
<span id="cb24-8">                ((FIXED FIXED) VALUE)))))))</span></code></pre></div>
</div>
<p>Did you know this is called continuation passing style?</p>
<blockquote class="blockquote">
<p>CSP?</p>
</blockquote>
<p>No, that’s communicating subprocesses.</p>
<blockquote class="blockquote">
<p>That’s confusing.</p>
</blockquote>
<p>Isn’t it!? Fortunately, we are about to be unconfused.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb25-1">(FIX REV-LOGIC)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb26-1">#object [REV-LOGIC$fn]</span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>At least it didn’t blow up this time…</p>
</blockquote>
<div class="sourceClojure">
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb27-1">((FIX REV-LOGIC) [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb28-1">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>Nice, that’s the right answer.</p>
</blockquote>
<p>Even nicer is that our fixed logic behaves like identity now:</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb29-1">((REV-LOGIC (FIX REV-LOGIC)) [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb30-1">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb31-1">((REV-LOGIC (REV-LOGIC (FIX REV-LOGIC))) [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb32-1">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>I can’t believe something so ridiculous actually works.</p>
</blockquote>
<p>Yes it is ridiculous to have all those silly names. Let’s fix that:</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb33-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> Z</span></span>
<span id="cb33-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [F]</span>
<span id="cb33-3">    ((<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [X]</span>
<span id="cb33-4">       (F (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [V] ((X X) V))))</span>
<span id="cb33-5">     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [X]</span>
<span id="cb33-6">       (F (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [V] ((X X) V)))))))</span></code></pre></div>
</div>
<p>You are not your variables. Rename them, rebind them. Your essence is invariant.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb34-1">((Z REV-LOGIC) [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb35-1">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>Wait, we are meant to be doing Fibonacci, remember?</p>
</blockquote>
<p>We are factoring out our <code>LOGIC</code>.</p>
<blockquote class="blockquote">
<p>It looks to me like you doubled the code, that’s not great refactoring. Using single letters make it totally unreadable.</p>
</blockquote>
<p>Hmmm, there does seem to be a lot of doubling. We can factor out a function for <code>f =&gt; (f f)</code>.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb36-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> REPLICATE </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Omega, the self-devouring serpent"</span></span>
<span id="cb36-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [F]</span>
<span id="cb36-3">    (F F)))</span></code></pre></div>
</div>
<p>The replication of identity is itself.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb37-1">((REPLICATE <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">identity</span>) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb38-1"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
</div>
<p>But test not the serpent lightly</p>
<div class="sourceCode" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb39-1">(REPLICATE REPLICATE)</span></code></pre></div>
<p><strong>stack overflow</strong></p>
<p>The replication of replication is eternal. Now we can clean up that duplication.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb40-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> Z</span></span>
<span id="cb40-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [LOGIC]</span>
<span id="cb40-3">    (REPLICATE (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [X]</span>
<span id="cb40-4">                 (LOGIC (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [V] ((X X) V)))))))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb41-1">((Z REV-LOGIC) [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb42-1">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>That’s not really any clearer…</p>
</blockquote>
<p>Very well, we can keep extracting.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb43-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> DEFER </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eta, the patient one"</span></span>
<span id="cb43-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [LOGIC]</span>
<span id="cb43-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [VALUE]</span>
<span id="cb43-4">      ((REPLICATE LOGIC) VALUE))))</span></code></pre></div>
</div>
<p>If the infinite is deferred, is it infinite?</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb44-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> FOLD </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Zeta, weaver of logic, bringer of finitude"</span></span>
<span id="cb44-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [LOGIC]</span>
<span id="cb44-3">    (REPLICATE (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [SELF]</span>
<span id="cb44-4">                 (LOGIC (DEFER SELF))))))</span></code></pre></div>
</div>
<p>OMEGA diverges, ZETA folds, LOGIC writes QED.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb45-1">((FOLD REV-LOGIC) [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb46-1">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
</div>
<p>That’s much nicer, I’m so glad you suggested using longer names.</p>
<blockquote class="blockquote">
<p>Can we write Fibonacci, <em>please</em>?</p>
</blockquote>
<p>Oh, that’s easy now!</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb47-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> FIB-LOGIC</span></span>
<span id="cb47-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [SELF]</span>
<span id="cb47-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [[B A <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:as</span> FIBS]]</span>
<span id="cb47-4">      (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&gt;</span> B <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb47-5">        FIBS</span>
<span id="cb47-6">        (SELF (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">concat</span> [(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">+</span> A B) B] FIBS))))))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb48-1">((FOLD FIB-LOGIC) [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb49-1">(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>That’s all backward!!</p>
</blockquote>
<p>Oh, my mistake</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb50-1">((FOLD REV-LOGIC) ((FOLD FIB-LOGIC) [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb51-1">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>]</span></code></pre></div>
</div>
<blockquote class="blockquote">
<p>You can’t be serious… This is ridiculous. We’ll be here forever if you keep this up.</p>
</blockquote>
<p>I love that idea! An infinite sequence is exactly what we need…</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb52-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> FIB-LOGIC-FOREVER</span></span>
<span id="cb52-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [SELF]</span>
<span id="cb52-3">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [A]</span>
<span id="cb52-4">      (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fn</span> [B]</span>
<span id="cb52-5">        (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lazy-seq</span></span>
<span id="cb52-6">          (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">cons</span> A ((SELF B) (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">+</span> A B))))))))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb53-1">(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">take</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> (((FOLD FIB-LOGIC-FOREVER) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb54-1">(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">89</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">377</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">610</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">987</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1597</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2584</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4181</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6765</span>)</span></code></pre></div>
</div>
<p>That’s so nice.</p>
<blockquote class="blockquote">
<p>Oh look at the time! I have a more important meeting to go to! <strong>disconnects</strong></p>
</blockquote>
<p>Ouch, Rough. ZCorp never got back to me, so let’s update the scoreboard as a loss.</p>
<div class="clay-table">
<div class="table-responsive">
<table class="table table-hover clay-table caption-top" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Interviews</th>
<th data-quarto-table-cell-role="th">Wins</th>
<th data-quarto-table-cell-role="th">GGs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>That’s all for today. Until next time, keep on coding.</p>
<div style="background-color:grey;height:2px;width:100%;"></div>
<div><pre><small><small>source: <a href="https://github.com/ClojureCivitas/clojurecivitas.github.io/blob/main/notebooks/code_interview/beating/with_stupid_stuff/z_combinator_gambit.clj">notebooks/code_interview/beating/with_stupid_stuff/z_combinator_gambit.clj</a></small></small></pre></div>



 ]]></description>
  <guid>https://clojurecivitas.github.io/code_interview/beating/with_stupid_stuff/z_combinator_gambit.html</guid>
  <pubDate>Sun, 25 May 2025 00:00:00 GMT</pubDate>
  <media:content url="https://clojurecivitas.github.io/code_interview/beating/with_stupid_stuff/z-combinator.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Core Async Flow Visualization</title>
  <dc:creator>Daniel Slutsky</dc:creator>
  <dc:creator>Timothy Pratley</dc:creator>
  <link>https://clojurecivitas.github.io/core/async/flow/visualization.html</link>
  <description><![CDATA[ 





<style></style>
<style>.printedClojure .sourceCode {
  background-color: transparent;
  border-style: none;
}
</style>
<style>.clay-limit-image-width .clay-image {max-width: 100%}
.clay-side-by-side .sourceCode {margin: 0}
.clay-side-by-side {margin: 1em 0}
</style>
<script src="core/async/flow/visualization_files/md-default0.js" type="text/javascript"></script>
<script src="core/async/flow/visualization_files/md-default1.js" type="text/javascript"></script>
<section id="visualizing-core.async.flows" class="level1">
<h1>Visualizing core.async.flows</h1>
<div class="sourceClojure">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb1-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> id-for </span>[x]</span>
<span id="cb1-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">cond</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">keyword?</span> x) (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">str</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">symbol</span> x))</span>
<span id="cb1-3">        (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vector?</span> x) (str/join <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">map</span> id-for x))</span>
<span id="cb1-4">        (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">string?</span> x) x</span>
<span id="cb1-5">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:else</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">str</span> x)))</span></code></pre></div>
</div>
<p>would be more interesting if we show the buffer state</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb2-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> conn-table </span>[flow]</span>
<span id="cb2-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [conns procs]} (datafy/datafy flow)</span>
<span id="cb2-3">        all-proc-chans (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">into</span> #{} cat conns)]</span>
<span id="cb2-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">TODO</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: add channel state</span></span>
<span id="cb2-5">    ^<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:kind/table</span></span>
<span id="cb2-6">    {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:row-maps</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vec</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> [[from to] conns]</span>
<span id="cb2-7">                      {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:source</span> (id-for from)</span>
<span id="cb2-8">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:target</span> (id-for to)}))}))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb3-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> proc-table </span>[flow]</span>
<span id="cb3-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [conns procs]} (datafy/datafy flow)</span>
<span id="cb3-3">        all-proc-chans (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">into</span> #{} cat conns)]</span>
<span id="cb3-4">    ^<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:kind/table</span></span>
<span id="cb3-5">    {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:column-names</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"process"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"start params"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"in chans"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"out chans"</span>]</span>
<span id="cb3-6">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:row-vectors</span>  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> [[proc-key proc-chans] (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">group-by</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">first</span> all-proc-chans)]</span>
<span id="cb3-7">                     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [args proc]} (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">get</span> procs proc-key)</span>
<span id="cb3-8">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [desc]} proc</span>
<span id="cb3-9">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [params ins outs]} desc]</span>
<span id="cb3-10">                       [(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span> proc-key)</span>
<span id="cb3-11">                        ^<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:kind/hiccup</span></span>
<span id="cb3-12">                        [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:div</span></span>
<span id="cb3-13">                         (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> [[k param] params]</span>
<span id="cb3-14">                           [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:div</span></span>
<span id="cb3-15">                            [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:div</span> [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:strong</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span> k)] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">get</span> args k)]</span>
<span id="cb3-16">                            [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:div</span> param]])]</span>
<span id="cb3-17">                        ^<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:kind/hiccup</span></span>
<span id="cb3-18">                        [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:div</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> [[k v] ins]</span>
<span id="cb3-19">                                [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:div</span> [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:strong</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span> k)] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span> v])]</span>
<span id="cb3-20">                        ^<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:kind/hiccup</span></span>
<span id="cb3-21">                        [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:div</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> [[k v] outs]</span>
<span id="cb3-22">                                [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:div</span> [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:strong</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span> k)] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span> v])]]))}))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb4-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> elkg </span>[flow]</span>
<span id="cb4-2">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [conns procs]} (datafy/datafy flow)</span>
<span id="cb4-3">        all-proc-chans (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">into</span> #{} cat conns)</span>
<span id="cb4-4">        chans-as-ports <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb4-5">        with-content <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>]</span>
<span id="cb4-6">    {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:id</span>            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"G"</span></span>
<span id="cb4-7">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:layoutOptions</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:elk.algorithm</span>         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"layered"</span></span>
<span id="cb4-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:elk.direction</span>         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DOWN"</span></span>
<span id="cb4-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:elk.hierarchyHandling</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"INCLUDE_CHILDREN"</span>}</span>
<span id="cb4-10">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:children</span></span>
<span id="cb4-11">     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> [[proc-key proc-chans] (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">group-by</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">first</span> all-proc-chans)]</span>
<span id="cb4-12">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [args proc]} (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">get</span> procs proc-key)</span>
<span id="cb4-13">             {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [desc]} proc</span>
<span id="cb4-14">             {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [params ins outs]} desc</span>
<span id="cb4-15">             width <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb4-16">             height <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb4-17">             <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">content</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">when</span> with-content</span>
<span id="cb4-18">                       [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:id</span>            (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">str</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span> proc-key) <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_content"</span>)</span>
<span id="cb4-19">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:width</span>         (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span> width <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb4-20">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:height</span>        (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span> height <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb4-21">                         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; nope, do it by id</span></span>
<span id="cb4-22">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:layoutOptions</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:content</span> (str/join <span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\newline</span></span>
<span id="cb4-23">                                                            (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> [[k param] params]</span>
<span id="cb4-24">                                                              (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">str</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span> k) <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" ("</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">get</span> args k) <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">") "</span> param)))}}])</span>
<span id="cb4-25">             <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">children</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> [[_ chan <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:as</span> proc-chan] proc-chans]</span>
<span id="cb4-26">                        {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:id</span>       (id-for proc-chan)</span>
<span id="cb4-27">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:width</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb4-28">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:height</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb4-29">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:labels</span>   [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:text</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span> chan)}]</span>
<span id="cb4-30">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:children</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vec</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">when</span> with-content</span>
<span id="cb4-31">                                          [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:id</span>            (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">str</span> (id-for proc-chan) <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_content"</span>)</span>
<span id="cb4-32">                                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:width</span>         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb4-33">                                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:height</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb4-34">                                            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; nope, do it by id</span></span>
<span id="cb4-35">                                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:layoutOptions</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:content</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">str</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span> chan)</span>
<span id="cb4-36">                                                                          <span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\newline</span> <span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\newline</span></span>
<span id="cb4-37">                                                                          (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">or</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">get</span> outs chan)</span>
<span id="cb4-38">                                                                              (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">get</span> ins chan)))}}]))})]</span>
<span id="cb4-39">         {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:id</span>            (id-for proc-key)</span>
<span id="cb4-40">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:width</span>         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb4-41">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:height</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb4-42">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:layoutOptions</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:org.eclipse.elk.nodeLabels.placement</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OUTSIDE V_TOP H_LEFT"</span>}</span>
<span id="cb4-43">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:labels</span>        [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:text</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span> proc-key)}]</span>
<span id="cb4-44">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:children</span>      (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vec</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">concat</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">content</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">when</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> chans-as-ports) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">children</span>)))</span>
<span id="cb4-45"></span>
<span id="cb4-46">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:ports</span></span>
<span id="cb4-47">          (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vec</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">when</span> chans-as-ports <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">children</span>))}))</span>
<span id="cb4-48">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:edges</span></span>
<span id="cb4-49">     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vec</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> [[from to] conns]</span>
<span id="cb4-50">            {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:id</span>      (id-for [from to])</span>
<span id="cb4-51">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:sources</span> [(id-for from)]</span>
<span id="cb4-52">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:targets</span> [(id-for to)]}))}))</span></code></pre></div>
</div>
<div style="background-color:grey;height:2px;width:100%;"></div>
<div><pre><small><small>source: <a href="https://github.com/ClojureCivitas/clojurecivitas.github.io/blob/main/notebooks/core/async/flow/visualization.clj">notebooks/core/async/flow/visualization.clj</a></small></small></pre></div>


</section>

 ]]></description>
  <guid>https://clojurecivitas.github.io/core/async/flow/visualization.html</guid>
  <pubDate>Sat, 17 May 2025 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Core Async Flow Exploration</title>
  <dc:creator>Daniel Slutsky</dc:creator>
  <dc:creator>Timothy Pratley</dc:creator>
  <link>https://clojurecivitas.github.io/core/async/flow/exploration.html</link>
  <description><![CDATA[ 





<style></style>
<style>.printedClojure .sourceCode {
  background-color: transparent;
  border-style: none;
}
</style>
<style>.clay-limit-image-width .clay-image {max-width: 100%}
.clay-side-by-side .sourceCode {margin: 0}
.clay-side-by-side {margin: 1em 0}
</style>
<script src="core/async/flow/exploration_files/md-default0.js" type="text/javascript"></script>
<script src="core/async/flow/exploration_files/md-default1.js" type="text/javascript"></script>
<p>One of Clojure’s superpowers is the ability to coordinate asynchronous operations using <code>core.async</code>. While powerful, these operations can become hard to reason about as they grow in complexity.</p>
<p>The new <code>core.async.flow</code> library offers a higher-level abstraction for modeling async processes as a <strong>Directed Acyclic Graph (DAG)</strong>. And now, with <a href="https://github.com/clojure/core.async.flow-monitor">flow-monitor</a>, we can <em>visualize</em> and <em>analyze</em> those flows.</p>
<p>Let’s walk through an exploration of such a flow.</p>
<section id="what-well-explore" class="level2">
<h2 class="anchored" data-anchor-id="what-well-explore">What We’ll Explore</h2>
<p>In this notebook, we’ll take a look at:</p>
<ol type="1">
<li><strong>Basic flow structure</strong>: What does a flow look like under the hood?</li>
<li><strong>Static visualization</strong>: How can we inspect its components?</li>
<li><strong>Dynamic interaction</strong>: How do values move through the flow, and what happens when they do?</li>
</ol>
</section>
<section id="creating-a-flow" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-flow">1. Creating a Flow</h2>
<p>Flows are created from configuration</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb1-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> stats-flow</span></span>
<span id="cb1-2">  (flow/create-flow stats/config))</span></code></pre></div>
</div>
<p>This flow models a small system involving aggregation, notification, and reporting. Internally, it consists of processes connected via channels.</p>
</section>
<section id="inspecting-the-flow" class="level2">
<h2 class="anchored" data-anchor-id="inspecting-the-flow">2. Inspecting the Flow</h2>
<p>Flows implement the <code>Datafy</code> protocol so we can inspect them as data.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb2-1">(datafy/datafy stats-flow)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb3-1">{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:procs</span></span>
<span id="cb3-2"> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:generator</span></span>
<span id="cb3-3">  {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:args</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:min</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:max</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:wait</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>},</span>
<span id="cb3-4">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:proc</span></span>
<span id="cb3-5">   {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:step</span> core.async.flow.example.stats/source,</span>
<span id="cb3-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:desc</span></span>
<span id="cb3-7">    {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:params</span></span>
<span id="cb3-8">     {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:min</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Min value to generate"</span>,</span>
<span id="cb3-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:max</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Max value to generate"</span>,</span>
<span id="cb3-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:wait</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time in ms to wait between generating"</span>},</span>
<span id="cb3-11">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:outs</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:out</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Output channel for stats"</span>}}}},</span>
<span id="cb3-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span></span>
<span id="cb3-13">  {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:args</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:min</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:max</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>},</span>
<span id="cb3-14">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:proc</span></span>
<span id="cb3-15">   {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:step</span> core.async.flow.example.stats/aggregator,</span>
<span id="cb3-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:desc</span></span>
<span id="cb3-17">    {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:params</span></span>
<span id="cb3-18">     {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:min</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Min value, alert if lower"</span>,</span>
<span id="cb3-19">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:max</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Max value, alert if higher"</span>},</span>
<span id="cb3-20">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:ins</span></span>
<span id="cb3-21">     {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Channel to receive stat values"</span>,</span>
<span id="cb3-22">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:poke</span></span>
<span id="cb3-23">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Channel to poke when it is time to report a window of data to the log"</span>},</span>
<span id="cb3-24">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:outs</span></span>
<span id="cb3-25">     {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alert</span></span>
<span id="cb3-26">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Notify of value out of range {:val value, :error :high|:low"</span>},</span>
<span id="cb3-27">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:workload</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:compute</span>}}},</span>
<span id="cb3-28">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:scheduler</span></span>
<span id="cb3-29">  {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:args</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:wait</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>},</span>
<span id="cb3-30">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:proc</span></span>
<span id="cb3-31">   {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:step</span> core.async.flow.example.stats/scheduler,</span>
<span id="cb3-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:desc</span></span>
<span id="cb3-33">    {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:params</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:wait</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time to wait between pokes"</span>},</span>
<span id="cb3-34">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:outs</span></span>
<span id="cb3-35">     {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:out</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poke channel, will send true when the alarm goes off"</span>}}}},</span>
<span id="cb3-36">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:notifier</span></span>
<span id="cb3-37">  {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:args</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:prefix</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Alert: "</span>},</span>
<span id="cb3-38">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:proc</span></span>
<span id="cb3-39">   {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:step</span> core.async.flow.example.stats/printer,</span>
<span id="cb3-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:desc</span></span>
<span id="cb3-41">    {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:params</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:prefix</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log message prefix"</span>},</span>
<span id="cb3-42">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:ins</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:in</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Channel to receive messages"</span>}}},</span>
<span id="cb3-43">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:chan-opts</span></span>
<span id="cb3-44">   {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:in</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:buf-or-n</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:type</span> SlidingBuffer, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:capacity</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>}}}}},</span>
<span id="cb3-45"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:conns</span></span>
<span id="cb3-46"> [[[<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:generator</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:out</span>] [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span>]]</span>
<span id="cb3-47">  [[<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:scheduler</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:out</span>] [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:poke</span>]]</span>
<span id="cb3-48">  [[<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alert</span>] [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:notifier</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:in</span>]]],</span>
<span id="cb3-49"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:execs</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:mixed</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nil</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:io</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nil</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:compute</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nil</span>},</span>
<span id="cb3-50"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:chans</span> {}}</span></code></pre></div>
</div>
<p>That’s a lot to take in! Fortunately, we can make things more digestible by viewing just the <strong>processes</strong> involved.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb4-1">(fv/proc-table stats-flow)</span></code></pre></div>
</div>
<div class="clay-table">
<div class="table-responsive">
<table class="table table-hover clay-table caption-top" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">process</th>
<th data-quarto-table-cell-role="th">start params</th>
<th data-quarto-table-cell-role="th">in chans</th>
<th data-quarto-table-cell-role="th">out chans</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>notifier</td>
<td><div>
<div>
<div>
<strong>prefix</strong>: Alert:
</div>
<div>
Log message prefix
</div>
</div>
</div></td>
<td><div>
<div>
<strong>in</strong>: Channel to receive messages
</div>
</div></td>
<td><div>

</div></td>
</tr>
<tr class="even">
<td>aggregator</td>
<td><div>
<div>
<div>
<strong>min</strong>: 1
</div>
<div>
Min value, alert if lower
</div>
</div>
<div>
<div>
<strong>max</strong>: 10
</div>
<div>
Max value, alert if higher
</div>
</div>
</div></td>
<td><div>
<div>
<strong>stat</strong>: Channel to receive stat values
</div>
<div>
<strong>poke</strong>: Channel to poke when it is time to report a window of data to the log
</div>
</div></td>
<td><div>
<div>
<strong>alert</strong>: Notify of value out of range {:val value, :error :high|:low
</div>
</div></td>
</tr>
<tr class="odd">
<td>scheduler</td>
<td><div>
<div>
<div>
<strong>wait</strong>: 3000
</div>
<div>
Time to wait between pokes
</div>
</div>
</div></td>
<td><div>

</div></td>
<td><div>
<div>
<strong>out</strong>: Poke channel, will send true when the alarm goes off
</div>
</div></td>
</tr>
<tr class="even">
<td>generator</td>
<td><div>
<div>
<div>
<strong>min</strong>: 0
</div>
<div>
Min value to generate
</div>
</div>
<div>
<div>
<strong>max</strong>: 12
</div>
<div>
Max value to generate
</div>
</div>
<div>
<div>
<strong>wait</strong>: 500
</div>
<div>
Time in ms to wait between generating
</div>
</div>
</div></td>
<td><div>

</div></td>
<td><div>
<div>
<strong>out</strong>: Output channel for stats
</div>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This table gives us a clear list of components in the flow, including their names and behaviors.</p>
<p>Next, let’s examine how these processes are <strong>connected</strong>.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb5-1">(fv/conn-table stats-flow)</span></code></pre></div>
</div>
<div class="clay-table">
<div class="table-responsive">
<table class="table table-hover clay-table caption-top" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">source</th>
<th data-quarto-table-cell-role="th">target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>generator_out</td>
<td>aggregator_stat</td>
</tr>
<tr class="even">
<td>scheduler_out</td>
<td>aggregator_poke</td>
</tr>
<tr class="odd">
<td>aggregator_alert</td>
<td>notifier_in</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now we’re seeing the wiring: who talks to whom, and through what channels.</p>
</section>
<section id="running-the-flow" class="level2">
<h2 class="anchored" data-anchor-id="running-the-flow">3. Running the Flow</h2>
<p>Time to bring our flow to life! Calling <code>start</code> activates the processes and returns a map of the important channels for interaction.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb6-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> chs </span>(flow/start stats-flow))</span></code></pre></div>
</div>
<p>We can now <strong>inject values</strong> into specific points in the flow. Think of this like poking the system and watching how it reacts.</p>
<p>We send a “poke” signal to the <code>aggregator</code> process.</p>
<p>We send a stat string that is designed to trigger an alert.</p>
<p>We send a notification message into the <code>notifier</code>.</p>
</section>
<section id="observing-the-results" class="level2">
<h2 class="anchored" data-anchor-id="observing-the-results">4. Observing the Results</h2>
<p>Our flow includes a <code>report-chan</code>, where summaries and reports might be sent.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb7-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> report-chan </span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:report-chan</span> chs))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb8-1">(flow/ping stats-flow)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb9-1">{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span></span>
<span id="cb9-2"> #<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow</span>{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:pid</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span>,</span>
<span id="cb9-3">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:status</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:paused</span>,</span>
<span id="cb9-4">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:state</span></span>
<span id="cb9-5">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:min</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb9-6">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:max</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb9-7">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/pid</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span>,</span>
<span id="cb9-8">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:vals</span> []},</span>
<span id="cb9-9">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-10">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:ins</span></span>
<span id="cb9-11">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span></span>
<span id="cb9-12">                            {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:put-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-13">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:take-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-14">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:closed</span>? <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>,</span>
<span id="cb9-15">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:buffer</span></span>
<span id="cb9-16">                             {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:type</span> FixedBuffer,</span>
<span id="cb9-17">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-18">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:capacity</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>}},</span>
<span id="cb9-19">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:poke</span></span>
<span id="cb9-20">                            {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:put-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-21">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:take-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-22">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:closed</span>? <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>,</span>
<span id="cb9-23">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:buffer</span></span>
<span id="cb9-24">                             {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:type</span> FixedBuffer,</span>
<span id="cb9-25">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-26">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:capacity</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>}}},</span>
<span id="cb9-27">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:outs</span></span>
<span id="cb9-28">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alert</span></span>
<span id="cb9-29">                            {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:put-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-30">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:take-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-31">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:closed</span>? <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>,</span>
<span id="cb9-32">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:buffer</span></span>
<span id="cb9-33">                             {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:type</span> SlidingBuffer,</span>
<span id="cb9-34">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-35">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:capacity</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>}}}},</span>
<span id="cb9-36"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:notifier</span></span>
<span id="cb9-37"> #<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow</span>{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:pid</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:notifier</span>,</span>
<span id="cb9-38">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:status</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:paused</span>,</span>
<span id="cb9-39">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:state</span></span>
<span id="cb9-40">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:prefix</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Alert: "</span>,</span>
<span id="cb9-41">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/pid</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:notifier</span>},</span>
<span id="cb9-42">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-43">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:ins</span></span>
<span id="cb9-44">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:in</span></span>
<span id="cb9-45">                            {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:put-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-46">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:take-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-47">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:closed</span>? <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>,</span>
<span id="cb9-48">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:buffer</span></span>
<span id="cb9-49">                             {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:type</span> SlidingBuffer,</span>
<span id="cb9-50">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-51">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:capacity</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>}}},</span>
<span id="cb9-52">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:outs</span> {}},</span>
<span id="cb9-53"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:generator</span></span>
<span id="cb9-54"> #<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow</span>{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:pid</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:generator</span>,</span>
<span id="cb9-55">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:status</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:paused</span>,</span>
<span id="cb9-56">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:state</span></span>
<span id="cb9-57">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:min</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-58">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:max</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,</span>
<span id="cb9-59">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:wait</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>,</span>
<span id="cb9-60">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/pid</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:generator</span>,</span>
<span id="cb9-61">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/in-ports</span></span>
<span id="cb9-62">                            {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span></span>
<span id="cb9-63">                             {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:put-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-64">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:take-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-65">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:closed</span>? <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>,</span>
<span id="cb9-66">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:buffer</span></span>
<span id="cb9-67">                              {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:type</span> FixedBuffer,</span>
<span id="cb9-68">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-69">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:capacity</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>}}},</span>
<span id="cb9-70">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stop</span> [<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>]},</span>
<span id="cb9-71">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-72">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:ins</span></span>
<span id="cb9-73">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span></span>
<span id="cb9-74">                            {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:put-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-75">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:take-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-76">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:closed</span>? <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>,</span>
<span id="cb9-77">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:buffer</span></span>
<span id="cb9-78">                             {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:type</span> FixedBuffer,</span>
<span id="cb9-79">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-80">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:capacity</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>}}},</span>
<span id="cb9-81">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:outs</span></span>
<span id="cb9-82">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:out</span></span>
<span id="cb9-83">                            {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:put-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-84">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:take-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-85">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:closed</span>? <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>,</span>
<span id="cb9-86">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:buffer</span></span>
<span id="cb9-87">                             {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:type</span> FixedBuffer,</span>
<span id="cb9-88">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-89">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:capacity</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>}}}},</span>
<span id="cb9-90"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:scheduler</span></span>
<span id="cb9-91"> #<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow</span>{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:pid</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:scheduler</span>,</span>
<span id="cb9-92">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:status</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:paused</span>,</span>
<span id="cb9-93">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:state</span></span>
<span id="cb9-94">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:wait</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>,</span>
<span id="cb9-95">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/pid</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:scheduler</span>,</span>
<span id="cb9-96">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/in-ports</span></span>
<span id="cb9-97">                            {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alarm</span></span>
<span id="cb9-98">                             {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:put-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-99">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:take-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-100">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:closed</span>? <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>,</span>
<span id="cb9-101">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:buffer</span></span>
<span id="cb9-102">                              {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:type</span> FixedBuffer,</span>
<span id="cb9-103">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-104">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:capacity</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>}}},</span>
<span id="cb9-105">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stop</span> [<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>]},</span>
<span id="cb9-106">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-107">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:ins</span></span>
<span id="cb9-108">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alarm</span></span>
<span id="cb9-109">                            {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:put-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-110">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:take-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-111">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:closed</span>? <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>,</span>
<span id="cb9-112">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:buffer</span></span>
<span id="cb9-113">                             {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:type</span> FixedBuffer,</span>
<span id="cb9-114">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-115">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:capacity</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>}}},</span>
<span id="cb9-116">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:outs</span></span>
<span id="cb9-117">                           {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:out</span></span>
<span id="cb9-118">                            {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:put-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-119">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:take-count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-120">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:closed</span>? <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>,</span>
<span id="cb9-121">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:buffer</span></span>
<span id="cb9-122">                             {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:type</span> FixedBuffer,</span>
<span id="cb9-123">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-124">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:capacity</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>}}}}}</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb10-1">(async/poll! report-chan)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb11-1"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nil</span></span></code></pre></div>
</div>
<p>After pinging the system, we check if anything landed in the report channel.</p>
<p>We can also inspect the <code>error-chan</code>, where any issues in the flow are reported.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb12-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> error-chan </span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:error-chan</span> chs))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb13-1">(async/poll! error-chan)</span></code></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb14-1"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nil</span></span></code></pre></div>
</div>
<p>If something unexpected occurred (e.g., bad input or failed routing), this is where we’d find it.</p>
<p>(flow/stop stats-flow) (async/close! stat-chan)</p>
<p>@(flow/inject stats-flow [:aggregator :poke] [true])</p>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>By constructing, inspecting, and interacting with a flow, we can understand the lifecycle and structure of asynchronous systems more clearly.</p>
<p>This toolset provides a bridge between the abstract beauty of DAGs and the gritty realism of channel communication—unlocking both power and clarity in asynchronous Clojure code.</p>
<p>Happy flowing!</p>
<div style="background-color:grey;height:2px;width:100%;"></div>
<div><pre><small><small>source: <a href="https://github.com/ClojureCivitas/clojurecivitas.github.io/blob/main/notebooks/core/async/flow/exploration.clj">notebooks/core/async/flow/exploration.clj</a></small></small></pre></div>


</section>

 ]]></description>
  <guid>https://clojurecivitas.github.io/core/async/flow/exploration.html</guid>
  <pubDate>Fri, 16 May 2025 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Core Async Flow Stats Example</title>
  <dc:creator>Alex Miller</dc:creator>
  <dc:creator>Timothy Pratley</dc:creator>
  <link>https://clojurecivitas.github.io/core/async/flow/example/stats.html</link>
  <description><![CDATA[ 





<style></style>
<style>.printedClojure .sourceCode {
  background-color: transparent;
  border-style: none;
}
</style>
<style>.clay-limit-image-width .clay-image {max-width: 100%}
.clay-side-by-side .sourceCode {margin: 0}
.clay-side-by-side {margin: 1em 0}
</style>
<script src="core/async/flow/example/stats_files/md-default0.js" type="text/javascript"></script>
<script src="core/async/flow/example/stats_files/md-default1.js" type="text/javascript"></script>
<p>Recently Alex provided a video walkthrough on how to use <code>core.async.flow</code> to build a stats monitor.</p>
<iframe allowfullscreen="allowfullscreen" src="https://www.youtube.com/embed/lXFwf3O4BVY" width="100%"></iframe>
<p>This notebook is adapted from <a href="https://github.com/puredanger/flow-example">his code</a>.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb1-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> stat-gen</span></span>
<span id="cb1-2">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Generates a random value between min (inclusive) and max (exclusive)</span></span>
<span id="cb1-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  and writes it to out chan, waiting wait ms between until stop-atom is flagged."</span></span>
<span id="cb1-4">  ([out <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">min</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">max</span> wait stop-atom]</span>
<span id="cb1-5">   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">loop</span> []</span>
<span id="cb1-6">     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">val</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">+</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">min</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">rand-int</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">max</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">min</span>)))</span>
<span id="cb1-7">           put (a/&gt;!! out <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">val</span>)]</span>
<span id="cb1-8">       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;(println "stat-gen" (System/identityHashCode stop-atom) val put (not @stop-atom))</span></span>
<span id="cb1-9">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">when</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> put (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@stop-atom</span>))</span>
<span id="cb1-10">         (^[<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">long</span>] Thread/sleep wait)</span>
<span id="cb1-11">         (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">recur</span>))))))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb2-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> source</span></span>
<span id="cb2-2">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source proc for random stats"</span></span>
<span id="cb2-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; describe</span></span>
<span id="cb2-4">  ([] {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:params</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:min</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Min value to generate"</span></span>
<span id="cb2-5">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:max</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Max value to generate"</span></span>
<span id="cb2-6">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:wait</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time in ms to wait between generating"</span>}</span>
<span id="cb2-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:outs</span>   {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:out</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Output channel for stats"</span>}})</span>
<span id="cb2-8"></span>
<span id="cb2-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; init</span></span>
<span id="cb2-10">  ([args]</span>
<span id="cb2-11">   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assoc</span> args</span>
<span id="cb2-12">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/in-ports</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span> (a/chan <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)}</span>
<span id="cb2-13">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stop</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">atom</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>)))</span>
<span id="cb2-14"></span>
<span id="cb2-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; transition</span></span>
<span id="cb2-16">  ([{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">min</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">max</span> wait <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/in-ports</span>] <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:as</span> state} transition]</span>
<span id="cb2-17">   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;(println "transition" transition)</span></span>
<span id="cb2-18">   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">case</span> transition</span>
<span id="cb2-19">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/resume</span></span>
<span id="cb2-20">     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [stop-atom (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">atom</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>)]</span>
<span id="cb2-21">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">future</span> (stat-gen (<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span> in-ports) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">min</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">max</span> wait stop-atom))</span>
<span id="cb2-22">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assoc</span> state <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stop</span> stop-atom))</span>
<span id="cb2-23"></span>
<span id="cb2-24">     (<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/pause</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/stop</span>)</span>
<span id="cb2-25">     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">do</span></span>
<span id="cb2-26">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reset!</span> (<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stop</span> state) <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">true</span>)</span>
<span id="cb2-27">       state)))</span>
<span id="cb2-28"></span>
<span id="cb2-29">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; transform</span></span>
<span id="cb2-30">  ([state in msg]</span>
<span id="cb2-31">   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;(println "source transform" in msg)</span></span>
<span id="cb2-32">   [state (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">when</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=</span> in <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span>) {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:out</span> [msg]})]))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb3-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> aggregator</span></span>
<span id="cb3-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; describe</span></span>
<span id="cb3-3">  ([] {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:params</span>   {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:min</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Min value, alert if lower"</span></span>
<span id="cb3-4">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:max</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Max value, alert if higher"</span>}</span>
<span id="cb3-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:ins</span>      {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Channel to receive stat values"</span></span>
<span id="cb3-6">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:poke</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Channel to poke when it is time to report a window of data to the log"</span>}</span>
<span id="cb3-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:outs</span>     {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alert</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Notify of value out of range {:val value, :error :high|:low"</span>}</span>
<span id="cb3-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:workload</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:compute</span></span>
<span id="cb3-9">       })</span>
<span id="cb3-10"></span>
<span id="cb3-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; init</span></span>
<span id="cb3-12">  ([args] (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assoc</span> args <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:vals</span> []))</span>
<span id="cb3-13"></span>
<span id="cb3-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; transition</span></span>
<span id="cb3-15">  ([state transition] state)</span>
<span id="cb3-16"></span>
<span id="cb3-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; transform</span></span>
<span id="cb3-18">  ([{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">min</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">max</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vals</span>] <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:as</span> state} input-id msg]</span>
<span id="cb3-19">   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">case</span> input-id</span>
<span id="cb3-20">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [state' (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assoc</span> state <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:vals</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">conj</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vals</span> msg))</span>
<span id="cb3-21">                 msgs (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">cond</span></span>
<span id="cb3-22">                        (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;</span> msg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">min</span>) {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alert</span> [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:val</span> msg, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:error</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:low</span>}]}</span>
<span id="cb3-23">                        (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">max</span> msg) {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alert</span> [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:val</span> msg, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:error</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:high</span>}]}</span>
<span id="cb3-24">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:else</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nil</span>)]</span>
<span id="cb3-25">             [state' msgs])</span>
<span id="cb3-26">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:poke</span> [(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assoc</span> state <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:vals</span> [])</span>
<span id="cb3-27">            {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/report</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">empty?</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vals</span>)</span>
<span id="cb3-28">                                               [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}]</span>
<span id="cb3-29">                                               [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:avg</span>   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">/</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">double</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reduce</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">+</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vals</span>)) (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">count</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vals</span>))</span>
<span id="cb3-30">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:count</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">count</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">vals</span>)}])}]</span>
<span id="cb3-31">     [state <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nil</span>])))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb4-1">(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">comment</span></span>
<span id="cb4-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; test aggregator alert case - no channels involved</span></span>
<span id="cb4-3">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [state {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:min</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:max</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:vals</span> []}</span>
<span id="cb4-4">        [state' msgs'] (aggregator state <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)]</span>
<span id="cb4-5">    (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assert</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=</span> msgs' {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alert</span> [{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:val</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:error</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:high</span>}]})))</span>
<span id="cb4-6">  )</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb5-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> scheduler</span></span>
<span id="cb5-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; describe</span></span>
<span id="cb5-3">  ([] {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:params</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:wait</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time to wait between pokes"</span>}</span>
<span id="cb5-4">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:outs</span>   {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:out</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poke channel, will send true when the alarm goes off"</span>}})</span>
<span id="cb5-5"></span>
<span id="cb5-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; init</span></span>
<span id="cb5-7">  ([args]</span>
<span id="cb5-8">   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assoc</span> args</span>
<span id="cb5-9">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/in-ports</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alarm</span> (a/chan <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)}</span>
<span id="cb5-10">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stop</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">atom</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>)))</span>
<span id="cb5-11"></span>
<span id="cb5-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; transition</span></span>
<span id="cb5-13">  ([{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [wait <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/in-ports</span>] <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:as</span> state} transition]</span>
<span id="cb5-14">   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;(println "scheduler transition" transition state transition)</span></span>
<span id="cb5-15">   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">case</span> transition</span>
<span id="cb5-16">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/resume</span></span>
<span id="cb5-17">     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [stop-atom (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">atom</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">false</span>)]</span>
<span id="cb5-18">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">future</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">loop</span> []</span>
<span id="cb5-19">                 (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">let</span> [put (a/&gt;!! (<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alarm</span> in-ports) <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">true</span>)]</span>
<span id="cb5-20">                   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">when</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> put (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@stop-atom</span>))</span>
<span id="cb5-21">                     (^[<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">long</span>] Thread/sleep wait)</span>
<span id="cb5-22">                     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">recur</span>)))))</span>
<span id="cb5-23">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assoc</span> state <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stop</span> stop-atom))</span>
<span id="cb5-24"></span>
<span id="cb5-25">     (<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/pause</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:clojure.core.async.flow/stop</span>)</span>
<span id="cb5-26">     (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">do</span></span>
<span id="cb5-27">       (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">reset!</span> (<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stop</span> state) <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">true</span>)</span>
<span id="cb5-28">       state)))</span>
<span id="cb5-29"></span>
<span id="cb5-30">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; transform</span></span>
<span id="cb5-31">  ([state in msg]</span>
<span id="cb5-32">   [state (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">when</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">=</span> in <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alarm</span>) {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:out</span> [<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">true</span>]})]))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb6-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> printer</span></span>
<span id="cb6-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; describe</span></span>
<span id="cb6-3">  ([] {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:params</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:prefix</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log message prefix"</span>}</span>
<span id="cb6-4">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:ins</span>    {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:in</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Channel to receive messages"</span>}})</span>
<span id="cb6-5"></span>
<span id="cb6-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; init</span></span>
<span id="cb6-7">  ([state] state)</span>
<span id="cb6-8"></span>
<span id="cb6-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; transition</span></span>
<span id="cb6-10">  ([state _transition] state)</span>
<span id="cb6-11"></span>
<span id="cb6-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; transform</span></span>
<span id="cb6-13">  ([{<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:keys</span> [prefix] <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:as</span> state} _in msg]</span>
<span id="cb6-14">   (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">println</span> prefix msg)</span>
<span id="cb6-15">   [state <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nil</span>]))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb7-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> config</span></span>
<span id="cb7-2">  {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:procs</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:generator</span>  {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:args</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:min</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:max</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:wait</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>} <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:proc</span> (flow/process <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">#'source</span>)}</span>
<span id="cb7-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:args</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:min</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:max</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>} <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:proc</span> (flow/process <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">#'aggregator</span>)}</span>
<span id="cb7-4">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:scheduler</span>  {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:args</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:wait</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>} <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:proc</span> (flow/process <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">#'scheduler</span>)}</span>
<span id="cb7-5">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:notifier</span>   {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:args</span>      {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:prefix</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Alert: "</span>} <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:proc</span> (flow/process <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">#'printer</span>)</span>
<span id="cb7-6">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:chan-opts</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:in</span> {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:buf-or-n</span> (a/sliding-buffer <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)}}}}</span>
<span id="cb7-7">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:conns</span> [[[<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:generator</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:out</span>] [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span>]]</span>
<span id="cb7-8">           [[<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:scheduler</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:out</span>] [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:poke</span>]]</span>
<span id="cb7-9">           [[<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:alert</span>] [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:notifier</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:in</span>]]]})</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb8-1">(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">defn</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> create-flow</span></span>
<span id="cb8-2">  []</span>
<span id="cb8-3">  (flow/create-flow config))</span></code></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb9-1">(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">comment</span></span>
<span id="cb9-2">  (<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> f </span>(create-flow))</span>
<span id="cb9-3">  (<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> chs </span>(flow/start f))</span>
<span id="cb9-4">  (flow/resume f)</span>
<span id="cb9-5">  (flow/pause f)</span>
<span id="cb9-6">  (flow/stop f)</span>
<span id="cb9-7"></span>
<span id="cb9-8">  (<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> server </span>(mon/start-server {<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:flow</span> f}))</span>
<span id="cb9-9">  (mon/stop-server server)</span>
<span id="cb9-10"></span>
<span id="cb9-11">  @(flow/inject f [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:poke</span>] [<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">true</span>])</span>
<span id="cb9-12">  @(flow/inject f [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:stat</span>] [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abc1000"</span>])          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;; trigger an alert</span></span>
<span id="cb9-13">  @(flow/inject f [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:notifier</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:in</span>] [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:sandwich</span>])</span>
<span id="cb9-14"></span>
<span id="cb9-15">  (<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> report-chan </span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:report-chan</span> chs))</span>
<span id="cb9-16">  (flow/ping f)</span>
<span id="cb9-17">  (a/poll! report-chan)</span>
<span id="cb9-18">  (<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">def</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> error-chan </span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:error-chan</span> chs))</span>
<span id="cb9-19">  (a/poll! error-chan)</span>
<span id="cb9-20"></span>
<span id="cb9-21">  (flow/stop f)</span>
<span id="cb9-22">  (a/close! stat-chan)</span>
<span id="cb9-23"></span>
<span id="cb9-24">  @(flow/inject f [<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:aggregator</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:poke</span>] [<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">true</span>])</span>
<span id="cb9-25"></span>
<span id="cb9-26">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">require</span> '[clojure.datafy <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:as</span> datafy])</span>
<span id="cb9-27">  (datafy/datafy f)</span>
<span id="cb9-28"></span>
<span id="cb9-29">  (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">require</span> '[clojure.core.async.flow-static <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:refer</span> [graph]])</span>
<span id="cb9-30">  (graph f)</span>
<span id="cb9-31"></span>
<span id="cb9-32">  )</span></code></pre></div>
</div>
<div style="background-color:grey;height:2px;width:100%;"></div>
<div><pre><small><small>source: <a href="https://github.com/ClojureCivitas/clojurecivitas.github.io/blob/main/notebooks/core/async/flow/example/stats.clj">notebooks/core/async/flow/example/stats.clj</a></small></small></pre></div>



 ]]></description>
  <guid>https://clojurecivitas.github.io/core/async/flow/example/stats.html</guid>
  <pubDate>Thu, 15 May 2025 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Noj Reload Executable</title>
  <dc:creator>Timothy Pratley</dc:creator>
  <link>https://clojurecivitas.github.io/scicloj/noj/intro/getting-started-noj.html</link>
  <description><![CDATA[ 





<p>Transcript of <a href="https://youtu.be/tDz1x2d65C0">Noj Reload Executable</a></p>
<p>Hello code champs, number ninjas and data divers!</p>
<p>Imagine being able to experiment with Clojure without needing to install tooling, set up editors, or even know about deps.edn Sounds like a dream, right? Well, dream no more—meet Noj’s new Code Reload Executable!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://clojurecivitas.github.io/scicloj/noj/intro/Noj-icon.svg" class="img-fluid figure-img"></p>
<figcaption>Noj</figcaption>
</figure>
</div>
<p>We can skip the Clojure tooling and editor setup, but we do need to install the recommended Adoptive Java. Now we download the latest Noj jar from the Scicloj Noj GitHub releases page. Let’s check the jar is in the Downloads directory, and that we have java installed by executing <code>java -version</code>.</p>
<p>Launch Noj using <code>java -jar</code> and the path to the jar file. Pro tip, if you press tab while typing a path, it will autocomplete. Noj is running, it created a directory called notebooks, and it recommends we create a Clojure file there.</p>
<p>I’ll create my file with Notepad, being careful to create a .clj file rather than a text file. When I saved that file, a browser window opened. Let’s put them side by side. Every time I save the file, the notebook updates.</p>
<p>If I’m interested in one particular top-level form, I can narrow the output by adding ,, anywhere in the form. And removing it renders the full notebook. And check this out—comments are rendered as Markdown. How cool is that? What an easy way to get coding!</p>
<p>Noj isn’t just a notebook—it’s a fully featured data science environment. It includes interesting datasets that can be queried and the results shown as tables or even better as charts.</p>
<p>Noj makes experimenting with Clojure easier than ever. No setup headaches, no complicated tooling—just pure coding joy.</p>
<p>Until next time, Keep on coding</p>



 ]]></description>
  <guid>https://clojurecivitas.github.io/scicloj/noj/intro/getting-started-noj.html</guid>
  <pubDate>Tue, 06 May 2025 00:00:00 GMT</pubDate>
</item>
</channel>
</rss>
